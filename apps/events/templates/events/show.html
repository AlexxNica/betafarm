{% extends "base.html" %}
{% from "layout/breadcrumbs.html" import breadcrumbs %}
{% from "layout/helpers.html" import address, gmap %}

{% block page_title -%}
{{ _('{event_name} : Events : Mozilla Innovation')|f(event_name=event.name) }}
{% endblock -%}

{% block breadcrumbs -%}
{{ breadcrumbs(
    (url('innovate_splash'), _('Innovation Home')),
    (url('events_all'), _('Events')),
    last=event.name) }}
{% endblock -%}

{% if request.user.is_authenticated() -%}
  {% if request.user.get_profile() in event.attendees.all() -%}
     {% set form_action = url('events_unattend', slug=event.slug) %}
     {% set button_label = _('stop attending') %}
  {% else -%}
     {% set form_action = url('events_attend', slug=event.slug) %}
     {% set button_label = _('attend this event!') %}
  {% endif -%}
{% endif -%}

{% block content -%}
<section id="title" class="clearfix">
  <div class="c6">
    <h1 class="light noMargin">{{ event.name }}</h1>
  </div>
</section>

<section id="eventContent">
  <div class="c6">
    <p>{{ event.description }}
  </div>
  <div class="row clearfix">
    <div class="c1">
      <form method="post" action="{{ form_action }}">
        {{ csrf()|safe }}
        <button class="submit sans">{{ button_label }}</button>
      </form>
    </div>
    {% if event.venue -%}
      <div class="c6">
        {{ address(event.venue.name, event.venue.address,
                   event.venue.address_two, event.venue.city,
                   event.venue.state, event.venue.country,
                   event.venue.zip_code) }}
        <div id="venue_map">
          {{ gmap(event.venue.address, event.venue.city,
                  event.venue.state, event.venue.country,
                  event.venue.zip_code, 300, 300,
                  is_secure=request.is_secure()) }}
        </div>
      </div>
    {% endif -%}
  </div>
  <div class="row people clearfix">
    <div class="c1">
      <h2 class="light">{{ _('Attending') }}</h2>
    </div>
    <ul class="peopleList clearfix">
      {% for person in event.attendees.all() -%}
        <li class="c2">
          <img src="{{ MEDIA_URL }}{{ person.avatar_or_default }}" height="32" width="32">
          <span class="username"><a href="{{ url('users_profile', username=person.user.username) }}">{{ person.display_name }}</a></span>
        </li>
      {% endfor -%}
    </ul>
  </div>
</section>

{% endblock -%}
